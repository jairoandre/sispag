-- DDL SISTEMA SISPAG

-- USUARIO

CREATE TABLE USRDBVAH.TB_SISPAG_USUARIO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  DS_LOGIN VARCHAR2(30) NOT NULL UNIQUE,
  NM_TITULO VARCHAR2(75),
  NM_EMAIL VARCHAR2(75),
  CD_ROLE VARCHAR2(15) NOT NULL
);

CREATE SEQUENCE USRDBVAH.SEQ_SISPAG_USUARIO;

-- GUIA

CREATE TABLE USRDBVAH.TB_SISPAG_GUIA
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_USUARIO NUMBER(*) NOT NULL,
  CD_TIPO NUMBER(1) NOT NULL,
  DT_EMISSAO DATE NOT NULL,
  DT_RESPOSTA DATE NOT NULL,
  CD_REG_ANS VARCHAR2(6) NOT NULL,
  CD_CARTAO VARCHAR2(20) NOT NULL,
  CD_GUIA VARCHAR2(20) NOT NULL,
  CD_SOLICT VARCHAR2(20),
  CD_SENHA VARCHAR2(20),
  NM_PACIENTE VARCHAR2(50),
  CD_CNES VARCHAR2(15)
);

CREATE SEQUENCE USRDBVAH.SEQ_SISPAG_GUIA;

-- ITEM GUIA

CREATE TABLE USRDBVAH.TB_SISPAG_IT_GUIA
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_GUIA NUMBER(*) NOT NULL,
  CD_PRO_FAT VARCHAR2(8),
  NM_OUTRO VARCHAR2(30),
  CONSTRAINT TB_SISPAG_IT_GUIA_FK1 FOREIGN KEY (ID_GUIA) REFERENCES USRDBVAH.TB_SISPAG_GUIA (ID),
  CONSTRAINT TB_SISPAG_IT_GUIA_FK2 FOREIGN KEY (CD_PRO_FAT) REFERENCES DBAMV.PRO_FAT (CD_PRO_FAT)
);

CREATE SEQUENCE USRDBVAH.SEQ_SISPAG_IT_GUIA;

-- EVENTO

CREATE TABLE USRDBVAH.TB_SISPAG_EVENTO
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_GUIA NUMBER(*) NOT NULL,
  CD_TIPO NUMBER(1) NOT NULL,
  ID_USUARIO NUMBER(*) NOT NULL,
  ID_SETOR_O NUMBER(*),
  ID_SETOR_D NUMBER(*),
  DT_EVENTO DATE NOT NULL,
  CONSTRAINT TB_SISPAG_EVENTO_FK1 FOREIGN KEY (ID_GUIA) REFERENCES USRDBVAH.TB_SISPAG_GUIA (ID),
  CONSTRAINT TB_SISPAG_EVENTO_FK2 FOREIGN KEY (ID_USUARIO) REFERENCES USRDBVAH.TB_SISPAG_USUARIO (ID),
  CONSTRAINT TB_SISPAG_EVENTO_FK3 FOREIGN KEY (ID_SETOR_O) REFERENCES DBAMV.SETOR (CD_SETOR),
  CONSTRAINT TB_SISPAG_EVENTO_FK4 FOREIGN KEY (ID_SETOR_D) REFERENCES DBAMV.SETOR (CD_SETOR)
);

CREATE SEQUENCE USRDBVAH.SEQ_SISPAG_EVENTO;

-- MENSAGEM

CREATE TABLE USRDBVAH.TB_SISPAG_MSG
(
  ID NUMBER(*) PRIMARY KEY NOT NULL,
  ID_EVENTO NUMBER(*) NOT NULL,
  DT_MENSAGEM DATE NOT NULL,
  NM_DESCRICAO VARCHAR2(100),
  CONSTRAINT TB_SISPAG_MSG_FK1 FOREIGN KEY (ID_EVENTO) REFERENCES USRDBVAH.TB_SISPAG_EVENTO (ID)
);

CREATE SEQUENCE USRDBVAH.SEQ_SISPAG_MSG;

-- DROPS

DROP TABLE USRDBVAH.TB_SISPAG_MSG;
DROP TABLE USRDBVAH.TB_SISPAG_EVENTO;
DROP TABLE USRDBVAH.TB_SISPAG_IT_GUIA;
DROP TABLE USRDBVAH.TB_SISPAG_GUIA;
DROP TABLE USRDBVAH.TB_SISPAG_USUARIO;
DROP SEQUENCE USRDBVAH.SEQ_SISPAG_MSG;
DROP SEQUENCE USRDBVAH.SEQ_SISPAG_EVENTO;
DROP SEQUENCE USRDBVAH.SEQ_SISPAG_IT_GUIA;
DROP SEQUENCE USRDBVAH.SEQ_SISPAG_GUIA;
DROP SEQUENCE USRDBVAH.SEQ_SISPAG_USUARIO;
