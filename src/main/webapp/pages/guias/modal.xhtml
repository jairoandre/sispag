<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:vah="http://java.sun.com/jsf/composite/vah">

  <p:dialog id="modal" widgetVar="modal" height="400" header="GUIA" modal="true">
    <h:panelGroup id="content" layout="block">
      <p:panelGrid id="modalGrid">
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Tipo de Guia:" for="tipo"/>
          </p:column>
          <p:column>
            <p:selectOneMenu id="tipo" required="true" value="#{guiaCtrl.item.tipo}">
              <f:selectItems value="#{guiaCtrl.tipos}"/>
            </p:selectOneMenu>
          </p:column>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Convênio:" for="convenioAutoComplete"/>
          </p:column>
          <p:column>
            <p:autoComplete id="convenioAutoComplete" value="#{guiaCtrl.item.convenio}"
                            queryDelay="200"
                            var="item"
                            itemLabel="#{item['nome']}"
                            itemValue="#{item}"
                            onclick="this.setSelectionRange(0, this.value.length)"
                            converter="#{convenioConverter}"
                            inputStyleClass="vah-input"
                            completeMethod="#{convenioCtrl.completeMethod}"
                            placeholder="Nome..."
                            required="true">
              <p:ajax event="itemSelect" process="@this" update="#{p:component('registroAns')}"/>
            </p:autoComplete>
          </p:column>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Nº. Guia:" for="numeroGuia"/>
          </p:column>
          <p:column>
            <p:inputText id="numeroGuia" value="#{guiaCtrl.item.numeroGuia}" required="true"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Registro ANS:"/>
          </p:column>
          <p:column>
            <h:panelGroup id="registroAns">
              <p:inputText value="#{guiaCtrl.item.convenio.codigoAns}" rendered="#{not empty guiaCtrl.item.convenio}"
                           readonly="true"/>
              <p:inputText value="-" rendered="#{empty guiaCtrl.item.convenio}" readonly="true"/>
            </h:panelGroup>
          </p:column>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Nº. Solic.:" for="numeroSolicitacao"/>
          </p:column>
          <p:column>
            <p:inputText id="numeroSolicitacao" value="#{guiaCtrl.item.numeroSolicitacao}" required="true"/>
          </p:column>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Emissão:" for="dataEmissao"/>
          </p:column>
          <p:column>
            <p:calendar id="dataEmissao" value="#{guiaCtrl.item.dataEmissao}" pattern="dd/MM/yyyy" required="true"
                        mask="true" locale="pt_BR"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column colspan="6" styleClass="ui-widget-header">
            <h:outputText value="DADOS DO BENEFICIÁRIO"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Nº. Carteira:"/>
          </p:column>
          <p:column>
            <p:inputText value="#{guiaCtrl.item.cartao}"/>
          </p:column>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="CNES:"/>
          </p:column>
          <p:column colspan="3">
            <p:inputText value="#{guiaCtrl.item.cnes}"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Nome:" for="nomePaciente"/>
          </p:column>
          <p:column colspan="5">
            <p:inputText id="nomePaciente" value="#{guiaCtrl.item.paciente}" style="width: 450px;" required="true"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column colspan="6" styleClass="ui-widget-header">
            <h:outputText value="DADOS DO CONTRATADO EXECUTANTE"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Prestador:" for="prestadorAutoComplete"/>
          </p:column>
          <p:column colspan="5">
            <p:autoComplete id="prestadorAutoComplete" value="#{guiaCtrl.item.prestador}"
                            queryDelay="200"
                            var="item"
                            itemLabel="#{item['nome']}"
                            itemValue="#{item}"
                            onclick="this.setSelectionRange(0, this.value.length)"
                            converter="#{prestadorConverter}"
                            inputStyleClass="vah-input"
                            completeMethod="#{prestadorCtrl.completeMethod}"
                            placeholder="Nome..."
                            required="true">
              <p:ajax event="itemSelect" process="@this" update="#{p:component('cpfPrestador')}"/>
            </p:autoComplete>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Cód./CNPJ/CPF:"/>
          </p:column>
          <p:column colspan="5">
            <h:panelGroup id="cpfPrestador">
              <p:inputText value="#{guiaCtrl.item.prestador.cpf}" rendered="#{not empty guiaCtrl.item.prestador}"
                           readonly="true"/>
              <p:inputText value="-" rendered="#{empty guiaCtrl.item.prestador}" readonly="true"/>
            </h:panelGroup>
          </p:column>
        </p:row>
        <p:row>
          <p:column colspan="6" styleClass="ui-widget-header">
            <h:outputText value="PROCEDIMENTOS/OPME"/>
          </p:column>
        </p:row>
        <p:row>
          <p:column style="font-weight: bold;">
            <p:outputLabel value="Item:"/>
          </p:column>
          <p:column colspan="5">
            <p:autoComplete id="proFatAutoComplete" value="#{guiaCtrl.proFatToAdd}"
                            queryDelay="200"
                            var="item"
                            itemLabel="#{item['id']} - #{item['nome']}"
                            itemValue="#{item}"
                            onclick="this.setSelectionRange(0, this.value.length);"
                            converter="#{proFatConverter}"
                            inputStyleClass="vah-input"
                            inputStyle="width: 500px;"
                            completeMethod="#{proFatCtrl.completeMethod}"
                            placeholder="Nome...">
              <p:ajax event="itemSelect" process="@this" update="#{p:component('proFatItens')} proFatAutoComplete"
                      listener="#{guiaCtrl.onProFatSelect}"/>
            </p:autoComplete>
          </p:column>
        </p:row>
        <p:row>
          <p:column colspan="6">
            <h:panelGroup id="proFatItens" layout="block">
              <ui:repeat value="#{guiaCtrl.item.itens.toArray()}" var="item">
                <h:panelGroup layout="block" style="padding: 5px 5px 0;">
                  <p:commandButton value="#{item.nome}" action="#{guiaCtrl.removeItemGuia(item)}" process="@this"
                                   update="#{p:component('proFatItens')}" icon="fa fa-ban"/>
                </h:panelGroup>
              </ui:repeat>
            </h:panelGroup>
          </p:column>
        </p:row>
      </p:panelGrid>
    </h:panelGroup>
    <f:facet name="footer">
      <p:commandButton value="Salvar" ajax="true"
                       action="#{guiaCtrl.doSave}" process="@this modalGrid"
                       update="listWrapper modalGrid"
                       oncomplete="if (args &amp;&amp; !args.validationFailed) PF('modal').hide()"/>
      <p:commandButton value="Cancelar" ajax="true" process="@this" oncomplete="PF('modal').hide();"
                       styleClass="margin-left"/>
    </f:facet>
  </p:dialog>
</ui:composition>